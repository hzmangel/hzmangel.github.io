<!DOCTYPE html>
<html lang="zh-cn">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" MMDS Notes: W2 - Frequent Itemsets - Part II
 &middot;  湖间小筑" />
        <meta property="og:site_name" content="湖间小筑" />
        <meta property="og:url" content="http://hzmangel.github.io/post/mmds-w2-frequent-itemsets-p2/" />

        
            <meta property="og:type" content="article" />
            <meta property="og:article:published_time" content="2015-07-01T18:20:21&#43;08:00" />

            
                <meta property="og:article:tag" content="Programming" />
            
                <meta property="og:article:tag" content="mmds" />
            
                <meta property="og:article:tag" content="StudyLog" />
            
        

        <title>
            湖间小筑
            
                | MMDS Notes: W2 - Frequent Itemsets - Part II

            
        </title>

        <meta name="description" content="蓝天，小湖，湖水中一方小筑" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">

        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/atelier-dune.dark.min.css">

        <link rel="stylesheet" type="text/css" href="http://hzmangel.github.io/css/screen.css" />

        

        <link rel="canonical" href="http://hzmangel.github.io/post/mmds-w2-frequent-itemsets-p2/" />
    </head>

    <body>
        <div class="container" id="site-wrapper">
            <header>
    <div class="row">
        <div class="col-md-6" id="site-title">
            <a href="http://hzmangel.github.io/" title="湖间小筑" rel="home"><h2>湖间小筑</h2></a>
        </div>

        <div class="col-md-6" id="site-description">
            <i class="text-right muted"><div id="site-description">蓝天，小湖，湖水中一方小筑</div></i>
        </div>
    </div>

    <img src="/img/banner.jpg" class="img-responsive">
</header>

            <nav role="navigation">

</nav>





<div class="row">
    <div class="col-md-9">
        <section>
            <article class="post">

    <header>
        <h2 class="post-title"><a href='http://hzmangel.github.io/post/mmds-w2-frequent-itemsets-p2/'> MMDS Notes: W2 - Frequent Itemsets - Part II
</a> </h2>
        <div class="post-meta">发表于2015-07-01 18:20:21 </div>
    </header>

    <section>
        <div class="post-summary"><p>这一部分介绍 <em>A-Priori</em> 算法。</p>

<p>前一篇中所说的两种计算数据对次数的办法，都是 <em>one-pass</em> 的，程序在读入数据的同时，生成数据对，然后在数据对对应的计数上加1。这样数据读取完成后，直接查找计数的数即可得知结果。但是这个方法在在数据量过大时会超过主存的大小，从而在计算时引发换页，降低效率。而本篇要介绍的 <em>A-Priori</em> 算法，通过减少需要计算的数据对个数，从而减少对内存的需求。</p>

<p>这个算法的核心思想是 <em>monotonicity</em> ，即如果 <code>{I}</code> 是 <em>frequent itemset</em> ，那么它的所有子集都是 <em>frequent itemset</em> 。反过来说，如果一个元素不是 <em>frequent itemset</em> ，那么任何包含它的集合都不可能是。</p>

<h2 id="基本算法">基本算法</h2>

<p><em>A-Priori</em> 是一个 <em>two-pass</em> 算法，</p>

<h3 id="first-pass">First Pass</h3>

<p>在读取的过程中创建两张Hash表，一张表是将所有 <code>item</code> 映射为 <code>1</code> 到 <code>n</code> 的索引，减少后面引用时占用的内存。第二张表是将 <code>item</code> 的索引与 <code>item</code> 出现的次数对应起来。</p>

<h3 id="between-passes">Between Passes</h3>

<p>检查索引和出现次数映射的表，找出其中所有的 <em>frequent itemset</em> ，并将它们重新索引为 <code>1</code> 到 <code>m</code></p>

<h3 id="second-pass">Second Pass</h3>

<p>计算所有使用 <em>frequent itemset</em> 表中元素组成的数据对的 <em>support</em> 值。具体流程如下：</p>

<ol>
<li>对每一个 <em>basket</em> ，找出其中属于 <em>frequent itemset</em> 表中的元素。</li>
<li>为找到的元素构建数据对。</li>
<li>找到数据对对应的计数值，加上它出现的次数。</li>
</ol>

<p>最后，只需要检查第二次生成的数据就好。另外，如果需要求多于2个元素的 <em>itemset</em> ，可以按上述办法将算法级联计算。</p>

<hr />

<p>基本算法介绍完成，下面就是改进了。</p>

<blockquote>
<p>Mutation: it is the key to our evolution.</p>
</blockquote>

<h2 id="pcy">PCY</h2>

<p>在 <em>first pass</em> 的时候，内存中有很多空闲的地方，所以在给 <em>item</em> 计数的同时，生成出所有的 <em>pair</em> ，取 Hash 后，给对应的 <em>bucket</em> 加1 。在 <em>second pass</em> 的时候，只处理如下的数据对：</p>

<ol>
<li><code>i</code> 和 <code>j</code> 都是 <em>frequent items</em></li>
<li><code>{i, j}</code> 被 Hash 的 <em>bucket</em> 是 <em>frequent bucket</em></li>
</ol>

<p>这样 <em>second pass</em> 中需要处理的数据又能少一些了。</p>

<p>这个算法的原理是，如果一个 <em>pair</em> 是 <em>frequent pair</em> ，那么它对应的 <em>bucket</em> 一定超过 <em>support</em> 的阈值。而如果一个 <em>bucket</em> 没有超过阈值，那么里面的所有 <em>pair</em> 一定不是 <em>frequent pair</em> 。 注意：一个 <em>bucket</em> 是 <em>frequent bucket</em> 并不能保证其中的 <em>pair</em> 都是 <em>frequent pair</em> 。</p>

<h3 id="first-pass-1">First Pass</h3>

<pre><code>for b in buckets
  for item in b:
    count[item]++
  end

  for pair in b:
    bucket(hash(pair))++
  end
end
</code></pre>

<h3 id="between-passes-1">Between Passes</h3>

<p>除了找出 <em>frequent item</em> 外，还会把上一步中的 <em>hash bucket</em> 替换为 <em>bitmap</em> ，<code>1</code> 表示 <em>frequent bucket</em> ， <code>0</code> 表示不是。这样可以进一步减少内存空间的占用（从 <code>32bit</code> 降到 <code>1bit</code>）。</p>

<h3 id="second-pass-1">Second Pass</h3>

<p>根据上面列出的条件，找到 <em>canidate pair</em> ，计算。</p>

<p>PCY算法还有两个变种：</p>

<h2 id="multistage">Multistage</h2>

<p>这个算法的核心在于，在PCY算法的 <em>first pass</em> 后，并不开始对 <em>bucket</em> 做筛选，而是将其中属于 <em>frequent bucket</em> 的 <em>pair</em> 挑出来，再做一次 Hash ，从而进一步减少 <em>second pass</em> 中需要处理的数据量。从定义上来看，这个算法可能会有多个 <em>pass</em></p>

<h2 id="multihash">Multihash</h2>

<p>在 <em>first pass</em> 中，使用多个独立的Hash函数来计算 <em>bucket</em> 。相比物 Multistage ，它还是 <em>two pass</em> 的算法，但是它的风险在于在多个 Hash 的作用下，可能会有更多的 <em>frequent bucket</em> 。如果它能保证 <em>frequent bucket</em> 的数目足够小，那么我们就能在 <em>two pass</em> 获得 Multistage 的优点。</p>

<hr />

<p>算法的另一个发展趋势是获取到大部分的 <em>frequent itemsets</em> ，使用降低精确性的办法来换取效率。</p>

<h2 id="基本想法">基本想法</h2>

<p>对样本 <em>basket</em> 进行随机抽样，并在内存中对样本进行 <em>A-Priori</em> 或其改进版本的计算，此处需要计算所有的 <em>frequent itemsets</em> ，而不仅仅是 <em>pair</em> 。计算时使用的 <em>support threshold</em> 需要根据样本容量处理，例如抽样率为 <code>1/100</code> ，那么阈值也相应的变成 <code>s/100</code> 。在 <em>second pass</em> 的时候，可以使用整体数据来验证是否找到的真的是 <em>frequent pair</em> 。</p>

<p>这个算法有个问题有些 <em>set</em> 可能在样本中不是 <em>frequent</em> 但在全局中是，这里有一个稍微改进的办法是适当降低样本计算中的 <em>support</em> 阈值，例如从 <code>s/100</code> 降为 <code>s/125</code> ，不过这会需要更大的内存空间。（而且还是有可能会漏掉的吧&hellip;&hellip;）</p>

<h2 id="son-算法">SON 算法</h2>

<p>这个算法是将大的数据分成小集合分别读入内存进行计算，并将在任意一次计算中得到的 <em>frequent pair</em> 置于候选的位置。而在 <em>second pass</em> ，计算这些候选 <em>pair</em> 并得出最后结果。这个算法的核心是，任何一个 <em>pair</em> 如果是 <em>frequent pair</em> ，那么它一定会在某个子集中是 <em>frequent pair</em> 。</p>

<p>这个算法可以让计算并行化，以提高处理效率。</p>

<h2 id="toivonen-算法">Toivonen 算法</h2>

<p>在 <em>first pass</em> 中，使用子集基本算法一样的方法，抽样并计算，但是在取阈值的时候设置的稍低，例如 <code>s/125</code>，以尽可能的不要遗漏在全集中是 <em>frequent set</em> 的数据。此后设置一个 <em>negative border</em> 区间，以存放所有子集是 <em>frequent set</em> 但是本身不是的集合。在 <em>second pass</em> 的时候，计算所有候选 <em>frequent itemsets</em> 和 <em>negative border</em> 中的数据。</p>

<ul>
<li>如果 <em>negative border</em> 中没有数据是 <em>frequent itemsets</em> ，那么所得就是所需的 <em>frequent itemsets</em> .</li>
<li>如果在 <em>negative border</em> 中找到了 <em>frequent itesmsets</em> ，那么就需要重新取样进行计算，直到满足前一条的条件为止。</li>
</ul>

<p>证明：假设 <code>S</code> 是一个在全集中的 <em>frequent itemset</em> ，但是在抽样样本中，它既不属于 <em>frequent itemsets</em> 也不是 <em>negative border</em> 。那么可以找到一个 <code>T</code> ，它是在样本中非 <em>frequent</em> 的 <code>S</code> 最小子集。即比 <code>T</code> 小的子集在样本中都是 <em>frequent itemset</em> ，那根据 <em>negative border</em> 的定义，<code>T</code> 一定会在 <em>negative border</em> 中，否则它就不是是最小子集。由于空集总是 <em>frequent itemset</em> ，所以 <code>T</code> 一定存在。这样就有一个 <code>T</code> ，它在全集中是 <em>frequent itemset</em> ，在样本中是 <em>negative border</em> ，于是，重新抽样吧。</p></div>
    </section>

    <footer>
        <div class="post-meta">
            分类：
            <ul class="list-inline">
                 <li><a href="/categories/happy-coding">Happy coding</a></li> 
            </ul>
        </div>

        <div class="post-meta">
            标签：
            <ul class="list-inline">
                 <li><a href="/tags/programming"><span class="label label-default">Programming</span></a></li>  <li><a href="/tags/mmds"><span class="label label-default">mmds</span></a></li>  <li><a href="/tags/studylog"><span class="label label-default">StudyLog</span></a></li> 
            </ul>
        </div>

        <br/>
        <nav class="post-meta">
            <p class="col-md-6">
                 <a class="previous" href="http://hzmangel.github.io/post/mmds-w2-frequent-itemsets-p1/"> &lt; MMDS Notes: W2 - Frequent Itemsets - Part I
 </a> 
            </p>

            <p class="col-md-6">
                 <a class="next" href="http://hzmangel.github.io/post/mmds-w3-communities-in-social-networks-basic/"> MMDS Notes: W3 - Communities in Social Network (Basic)
 &gt;</a> 
            </p>
        </nav>
        <br/>

    </footer>

</article>

<div id="disqus_thread"></div>
<script type="text/javascript">
     
    var disqus_shortname = "hzmangel";

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>


        </section>
    </div>

    <div class="col-md-3">
        <aside id="sidebar">

    <div class="sidebar-block">
        <h5>新鲜出炉</h5>
        <ul class="list-unstyled">
        
            <li><a href='http://hzmangel.github.io/categories/'> Categories</a></li>
        
            <li><a href='http://hzmangel.github.io/categories/happy-coding/'> Happy coding</a></li>
        
            <li><a href='http://hzmangel.github.io/post/'> Posts</a></li>
        
            <li><a href='http://hzmangel.github.io/tags/programming/'> Programming</a></li>
        
            <li><a href='http://hzmangel.github.io/tags/rails/'> rails</a></li>
        
        </ul>
    </div>

    <div class="sidebar-block">
        <h5>分类</h5>
        <ul class="list-unstyled">
        
            <li><a href="/categories/bt~~up">bt~~up</a> &nbsp;(23)</li>
        
            <li><a href="/categories/happy-coding">happy-coding</a> &nbsp;(93)</li>
        
            <li><a href="/categories/%E5%96%84%E7%94%A8%E4%BD%B3%E8%BD%AF">善用佳软</a> &nbsp;(26)</li>
        
            <li><a href="/categories/%E5%A5%BD%E4%B8%9C%E4%B8%9Clatex">好东东latex</a> &nbsp;(20)</li>
        
            <li><a href="/categories/%E5%B0%8F%E4%BC%81%E9%B9%85linux">小企鹅linux</a> &nbsp;(73)</li>
        
            <li><a href="/categories/%E6%90%AD%E5%95%8A%E6%90%AD%E6%90%AD%E7%94%B5%E8%B7%AF">搭啊搭搭电路</a> &nbsp;(7)</li>
        
            <li><a href="/categories/%E6%9D%82%E4%B9%9D%E6%9D%82%E5%8D%81_">杂九杂十_</a> &nbsp;(140)</li>
        
            <li><a href="/categories/%E6%B8%B8%E6%88%8F%E4%BA%BA%E7%94%9F">游戏人生</a> &nbsp;(13)</li>
        
            <li><a href="/categories/%E9%82%A3%E5%B1%B1%E9%82%A3%E6%B0%B4">那山那水</a> &nbsp;(52)</li>
        
            <li><a href="/categories/%E9%A3%8E%E9%9B%A8%E8%80%83%E7%A0%94%E8%B7%AF">风雨考研路</a> &nbsp;(11)</li>
        
            <li><a href="/categories/%E9%A5%95%E9%A4%AE%E4%B9%8B%E4%BA%AB">饕餮之享</a> &nbsp;(4)</li>
        
        </ul>
    </div>

    <div class="sidebar-block">
        <h5>标签</h5>
        <div id="tag_cloud" data-tags=" ['admin', 4, '/tags/admin'];  ['android', 1, '/tags/android'];  ['base64', 1, '/tags/base64'];  ['blog', 1, '/tags/blog'];  ['carrierwave', 1, '/tags/carrierwave'];  ['dtrace', 1, '/tags/dtrace'];  ['elasticsearch', 1, '/tags/elasticsearch'];  ['flex', 1, '/tags/flex'];  ['gfw', 1, '/tags/gfw'];  ['golang', 4, '/tags/golang'];  ['hadoop', 1, '/tags/hadoop'];  ['ios', 6, '/tags/ios'];  ['java', 1, '/tags/java'];  ['javascript', 2, '/tags/javascript'];  ['jqplot', 1, '/tags/jqplot'];  ['jquery', 2, '/tags/jquery'];  ['linux', 15, '/tags/linux'];  ['meta', 1, '/tags/meta'];  ['mmds', 7, '/tags/mmds'];  ['objc', 1, '/tags/objc'];  ['performance', 1, '/tags/performance'];  ['php', 1, '/tags/php'];  ['programming', 60, '/tags/programming'];  ['python', 8, '/tags/python'];  ['rails', 12, '/tags/rails'];  ['regexp', 1, '/tags/regexp'];  ['ruby', 4, '/tags/ruby'];  ['rubyonrails', 4, '/tags/rubyonrails'];  ['studylog', 11, '/tags/studylog'];  ['til', 3, '/tags/til'];  ['tools', 7, '/tags/tools'];  ['vim', 4, '/tags/vim'];  ['仙剑', 1, '/tags/%E4%BB%99%E5%89%91'];  ['十渡', 1, '/tags/%E5%8D%81%E6%B8%A1'];  ['工作', 3, '/tags/%E5%B7%A5%E4%BD%9C'];  ['徒步', 16, '/tags/%E5%BE%92%E6%AD%A5'];  ['总结', 4, '/tags/%E6%80%BB%E7%BB%93'];  ['感想', 7, '/tags/%E6%84%9F%E6%83%B3'];  ['摄影', 14, '/tags/%E6%91%84%E5%BD%B1'];  ['旅行', 27, '/tags/%E6%97%85%E8%A1%8C'];  ['游戏', 1, '/tags/%E6%B8%B8%E6%88%8F'];  ['电影', 1, '/tags/%E7%94%B5%E5%BD%B1'];  ['骑行', 8, '/tags/%E9%AA%91%E8%A1%8C']; " />
    </div>

</aside>



    </div>
</div>

        <footer class="site-footer clearfix">
            <div id="colophon">
                <section class="col-md-7">Copyright - ©2015 - hzmangel</section>
                
                    <i class="text-right"><section class="col-md-5">Proudly generated by <a class="icon-hugo" href="http://gohugo.io">HUGO</a>, with <a class="icon-theme" href="https://github.com/hzmangel/hugo-twenty-ten">ported Twenty Ten</a> theme</section></i>
                
            </div>
        </footer>

        <script src="http://code.jquery.com/jquery-git2.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>

        <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$','$'], ['\\(','\\)']],
            displayMath: [['$$','$$'], ['\[','\]']],
            processEscapes: true,
            processEnvironments: true,
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            TeX: { equationNumbers: { autoNumber: "AMS" },
                 extensions: ["AMSmath.js", "AMSsymbols.js"] }
          }
        });
        </script>

        <script type="text/x-mathjax-config">
          MathJax.Hub.Queue(function() {
            // Fix <code> tags after MathJax finishes running. This is a
            // hack to overcome a shortcoming of Markdown. Discussion at
            // https://github.com/mojombo/jekyll/issues/199
            var all = MathJax.Hub.getAllJax(), i;
            for(i = 0; i &lt; all.length; i += 1) {
                all[i].SourceElement().parentNode.className += ' has-jax';
            }
        });
        </script>

        <script type="text/javascript" src="http://hzmangel.github.io/js/index.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
                (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-1847567-5', 'auto');
            ga('send', 'pageview');
        </script>

    </div> 

</body>
</html>



